<hr>

### ハードウェア関連(101)

##### ハードウェア
https://www.sophia-it.com/content/%E3%83%8F%E3%83%BC%E3%83%89%E3%82%A6%E3%82%A7%E3%82%A2  

コンピュータを物理的に構成している回路は周辺機器のこと```CPU、メモリ、HDD、マウス、キーボード、ディスプレイなど。

##### Linuxのハードウェア情報

https://web.mit.edu/rhel-doc/4/RH-DOCS/rhel-rg-ja-4/s1-proc-topfiles.html

```
/sys                  ドライバ、カーネル、ハードウェア関連情報。                           システム起動時に作成される。
/proc                 カーネルパラメータ、プロセス情報など。内容変更すると即座に反映される。    システムとプロセス同時に作成される。
/proc/cmdline         システム起動時に、ブートローダーからカーネル起動時に渡されるパラメータが表示される。
/proc/cpuinfo         システムが使用するプロセッサーのタイプを確認。
/proc/inports         登録済みデバイスのポート一覧を表示。デバイスとの入出力時に使われる。
/proc/interrupts      IRQ毎の割り込み回数が記録される。

IRQ...キーボードやマウスなどの入出力デバイスが、CPUを呼び出すときに生成される割り込み要求の信号のこと。ハードウェア毎に0~15の番号が割 り振られ、CPUを使用するための優先度が決められている。
https://kotobank.jp/word/IRQ-62
https://www.techhub.tokyo/words/irqnumber/

proc/scsi/scsi        SCSIデバイス情報。

SCSI...Small Computer System Interface（スモールコンピュータシステムインタフェース）。
       ハードディスクやCD-ROM、イメージスキャナなど、様々な周辺機器の接続に使われていたインタフェース規格。パラレル方式。
       外付けの機器を数珠つなぎに連結（ティジーチェーン）していき、最大７台まで接続可能。2002年でパラレル方式の企画は終了している。
       https://medium-company.com/scsi/
       https://www.ratocsystems.com/products/subpage/scsi/scsi.html

シリアルバスとパラレルバス
  パラレルバスは高速になるほど信号間のタイミングを取りにくくなり、シリアルバスが主流になっている。
  シリアルバス...1bitずつ順番に直列でデータを転送していく。USB、HDD、CD・DVDドライブなどを接続する規格で使われている。
               SATA、IEEE1394、PCI Express、SASなど。
  パラレルバス...複数のbitをまとめて並列回路で転送していく。IDE、SCSI、PCI、パラレルATAなど。
  https://medium-company.com/%e3%83%91%e3%83%a9%e3%83%ac%e3%83%ab%e3%83%90%e3%82%b9-%e3%82%b7%e3%83%aa%e3%82%a2%e3%83%ab%e3%83%90%e3%82%b9/

proc/bus/pci/devices  PCIデバイス情報。

PCI...マザーボードに差込み機能を拡張するPCIカードがある。
      http://www.linux-beginner.com/linux_kihon272.html

proc/bus/pci/devices  USBデバイス情報
proc/dma              DMAチャネルに関する情報

DMA...Direct Memory Access。デバイスとメインメモリがCPUを使わずに高速データ転送を行う為の規格。
DMAコントローラ...マザーボードなどに搭載される、DMA転送の制御を行うICチップ。
DMAチャネル...各装置がDMAコントローラに対して転送を要求するために用いる通信経路.
http://linux-network.cocolog-nifty.com/blog/2011/12/dma-8d7f.html
https://e-words.jp/w/DMA.html


/dev                  HDDや接続されているデバイスのファイルが格納される。システム起動時に作成される。

コールドプラグデバイス...システム停止状態でデバイスの接続を行っておき、システム起動時に認識させる機能。メモリ、ビデオカード、サウンドカードjなど。
ホットプラグデバイス...システム起動状態でデバイスの接続ができる機能。USBメモリなど。

udev                  Linuxカーネル用のデバイス管理ツール。新しいデバイスを接続・解除した時に、事前に定義したルールに基づきデバイスを管理する。つまり、現在接続されているデバイスだけ /dev ディレクトリにデバイスファイルを作成ことができ、無駄がなくなる。/usr/lib/udev/rules.d/配下の 各rulesファイルに定義する。
https://hogetech.info/2020/10/04/udev-%E5%85%A5%E9%96%80/

D-Bus...１台のコンピュータ上で動作する複数のプログラムの間で情報を交換するメッセージバスシステム。デバイスの接続や設定変更の通知に使われる。
http://lfsbookja.osdn.jp/7.10-systemd/chapter06/dbus.html


cat /proc/cpuinfo | less     linuxOSのCPU情報が見れる
cat /proc/scsi/scsi | less   scsi情報を表示
ls  /dev                     接続されたデバイスを表示
ls /etc/udev/rules.d         デバイスルールの定義ファイルを表示
```

<hr>

##### モジュール

Linuxカーネルの機能の一部を、カーネル本体とは別にロード、アンロードできるように分離したバイナリファイルのこと。ハードウェアにアクセスし、操作するためのドライバ部分がモジュールに当たる。
https://atmarkit.itmedia.co.jp/ait/articles/1901/10/news012.html

・モジュールのコマンド
https://atmarkit.itmedia.co.jp/ait/articles/1812/27/news036.html

```
modprobe モジュール名     他のモジュールとの依存関係を考慮し、メモリに読み込む。rootユーザのみ実行可能.
modprobe -r モジュール名  メモリからモジュールを削除する

insmod モジュール名       モジュールをロードする。(依存関係を考慮しない)
rmsmod モジュール名       モジュールをアンロードする。(依存関係を考慮しない)
lsmod                   ロードされているモジュール一覧表示(ロード中のモジュールは/proc/modulesにある)
lspci                   接続されているPCIデバイスを表示    yum install pciutils
lsusb                   接続されているUSBを表示           yum install usbutils

・実際に使ってみる

lsmod | grep -E '^parport|^lp'    parportとlpのどちらもヒットしないのを確認
modprobe lp                       モジュールの読み込み
再度 lsmod | grep -E '^parport|^lp'  lpに依存したparportモジュールも同時に読み込まれた
modprobe -r lp                    parportも一緒に削除

unxz /lib/modules/4.18.0-348.2.1.el8_5.x86_64/kernel/drivers/parport/parport.ko.xz  xzファイルを解凍
insmod /lib/modules/4.18.0-348.2.1.el8_5.x86_64/kernel/drivers/parport/parport.ko   個別にモジュールをロード(lpモジュールも個別でロードが必要)
rmmod  parport
```

<hr>

### ハードディスクのレイアウトとパーティション

・パーティション  
1つのディスクを論理的に分割すること。パーティション毎にドライブ名が割り当てられる。  
Linuxでは /dev/hda ディスクを /dev/hda1 /dev/hda2 と分けていく

https://qiita.com/miyuki_samitani/items/99b3325e7bf7b399fb88  
https://www.iodata.jp/lib/manual/hdpn-u/data/basic.htm  

・MBR(Master Boot Record)  BIOSのパーティション管理方式。認識できる容量は２TBまで。パーティション区分は4つまで。

```
・基本パーティション
OSの起動に必要なファイルが格納されているパーティションのこと。
論理パーティションも含め、1つの物理ディスクに最大4個までパーティションを作成可。

・拡張パーティション
基本パーティションの中の1つを拡張パーティションとして使用可。直接ファイルシステムを作成できないが、論理パーティションを格納する。

・論理パーティション
```

・EFIシステムパーティション
https://www.diskpart.com/jp/articles/efi-system-partition.html

```
データ記憶装置（HDDやSSDなど）のパーティションの一つで、UEFIに準拠するコンピュータ(Windows OSまたはMac OS)で使われる。GPT形式のパーティション。
UEFI...BIOSの後継機。起動ドライブの容量制限２TBからの開放や、GUIセットアップ機能が拡張されている。
```

・GPT    GUID Partition Table

```
拡張・論理パーティションは使用せず、基本パーティションのみ使用する。最大128個のパーティションを作成可能。容量は8ZBまで可。EFIシステムパーティションもこれに含まれる。
```

・LVM    Logical Volume Manager  
ディスクの物理的なパーティションを直接操作せずに、仮想的な論理ボリュームを用いて管理する。  
複数のハードディスクやパーティションにまたがった記憶領域をまとめて、単一の論理ボリューム（LV）として仮想的に扱うことができる。  
スナップショットの作成可能。  

https://www.pmi-sfbac.org/linux-lvm/

```
構成要素...物理ボリューム(PV)、ボリュームグループ(VG)、論理ボリューム(LV)

LVMは、ハードディスクを「PE（フィジカルエクステント）」と言う記憶領域に分割し、必要な時に必要な分だけ使用することが可能

・PE  フィジカルエクステント
LVMが扱う記憶領域の最小単位。デフォルトが4MB、最大65,536個まで作ることができる。デフォルトの４MBで最大256GBの容量を扱える。

パーティションの関係性    左から順に作成していく
   分割   分割   収束   分割   分割
HDD => PV => PE => VG => LV => パーティション
https://qiita.com/miyuki_samitani/items/ee3f93fa82d6ada1fa37
```

・fdiskコマンド  
MBRのパーディションを作成、削除する  
https://atmarkit.itmedia.co.jp/ait/articles/1803/01/news034.html

```
fdisk -l デバイス名    指定したデバイスのパーディションを表示
fdisk -s デバイス名    指定したデバイスのブロック数を表示
fdisk デバイス名       対話モード起動

対話モードのコマンド
m     コマンド一覧の表示
p     パーティションを表示
v     パーティションを検査
l     変更可能なパーディションタイプの表示
t     パーティションの変更
n     新しいパーディションを作成
a     ブート可能フラグの切り替え
d     パーティションの削除
w     変更を保存して終了
q     変更を保存せずに終了
```

・gdiskコマンド  
GPTのパーディションを作成、削除する。操作方法はほぼ同じ。  
コマンド一覧表示は「？」  
https://atmarkit.itmedia.co.jp/ait/articles/1803/02/news017.html


・partedコマンド  
MBR、GPT両方のパーティション管理を行う。
https://www.ricecake24book.com/linux-parted-command/

```
check 番号               ファイルシステムの簡単なチェック
mklabel  gpt or msdos   新しいパーティションの作成
mkpart 種類 開始 終了     指定した種類のパーディションを作成
rm 番号                  パーティションの削除
print                   パーティションテーブルを表示
quit                    抜ける

lsblk                   パーティションとファイルシステムの情報を表示
```

・パーティション分割  
ディスク領域を複数に分割すること。データを整理し、必要な箇所のみにアクセスすることで速度を早める。  

```
/root                   ファイルシステムの最上位ディレクトリ。ルートディレクトリと呼ばれる。
スワップ領域              物理メモリが少なくなった時にディスクの一部を仮想メモリとして使う為の領域(物理メモリの１〜2倍)
/boot                   Linuxの起動に必要なファイルを配置する。容量不足をを考慮してパーティションを/bootと分けておく。
/home                   ユーザごとに作成されるホームディレクトリ。
/var                    ログファイルがおかれるディレクトリ。Webサーバなどで利用する場合、ログが大量になる為個別のパーティションを作成する。
/tmp                    一時的なファイルを配置。システムの再起動や一定期間の経過で削除される。
https://linuc.org/study/knowledge/548/
/usr                    OSのプログラムやライブラリがインストールされる。
```

### ファイルシステム

コンピュータがファイル操作をする為の管理機能のこと。HDDやUSBはフォーマットを行い、ファイルシステムの機能によってデータの保存や削除ができるようになる。  
https://pc-kaizen.com/what-is-filesystem  

ファイルシステムがない場合、容量を数値で扱いデータの操作を行う。  
ファイルシステムがある場合、/data内のsample.txtといったようにファイルの扱いが視認できる。  

・ファイルシステムの種類

```
ext2                Linuxの標準ファイルシステム
ext3                ext2にジャーナリング機能(ファイルシステムへの操作をログに記録する仕組み)を備えたもの
ext4                ext3をさらに拡張した物。
XFS                 CentOSの標準ファイルシステム
JFS                 IBM社が開発したジャーナルファイルシステム
iso9660             CD-ROMのファイルシステム(DVDでも扱われる)   https://linuc.org/study/samples/2408/
UDF                 DVD-ROMのファイルシステム
Msdos               MS-DOSのファイルシステム
VFAT                SDカード、USBメモリなどフラッシュメモリで利用されているファイルシステム
tmpfs               メモリ上に作成される仮想ファイルシステム
```

・mkfsコマンド  
物理・論理パーティションにファイルシステムを作成する。

```
mkfs -t                     ファイルシステムの種類
mkfs -c                     ファイルシステム作成前にプログラムの検査をする

mke2fs                      ext2,3,4のファイルシステムを作成する。デフォルトはext2。
mke2fs -t ファイルシステム名   ファイルシステムの種類を指定して作成
mke2fs -j                   ext3のファイルシステムを作成
mke2fs -c                   実行前に不良ブロックの検査
```

・Btrfs  
Linuxの先進的ファイルシステム。開発中。

```
複数の物理ボリュームをまとめて仮想的なボリュームを作成可能。
スナップショットを作成し、バックアップ。
複数の物理ボリュームにまたがったファイルシステムの作成。
ファイルシステムを分割したサブモジュールの作成。
```

##### XFS

RHEL/CentOSで標準のファイルシステム。最大ファイルサイズは8Eバイト。

```
コマンド一覧

mkfs.xfs            ファイルシステムの作成
xfs_info            情報の表示
xfs_db              デバッグ
xfs_check           チェック
xfs_admin           パラメータ変更
xfs_fsr             デフラグ
xfs_repair          修復
```

##### スワップ領域

物理メモリが少なくなった時にディスクの一部を仮想メモリとして使う為の領域

```
mkswap パーティションのパス     指定したパーティションにスワップ領域を作成
swapon                      スワップ領域を有効にする
swapon -s                   スワップ領域一覧     cat /proc/swapsでも可
swapoff                     スワップ領域を無効にする
```

##### マウント

パーティションにファイルシステムを作成した後、パーティションとディレクトリを紐付ける(マウント)こと。  
マウントすることによりファイルやディレクトリの作成が可能になる。  
https://www.infraeye.com/study/linuxz24.html  

```
/etc/fstab     マウントするファイルシステムの情報を記述するファイル
https://linuc.org/study/knowledge/505/

中身
フィールド    1               2               3        4             5 6
          /dev/sda1        /home           ext4    defaults        1 1

第1フィールド：デバイス名
第2フィールド：マウントポイント
第3フィールド：ファイルシステムの種類
第4フィールド：各種オプション
第5フィールド：ファイルシステムをdumpするか否かの指定
第6フィールド：OS起動時にfsckチェックを行うか否かの指定を行う
```

##### mountコマンド

フォーマット済みの領域をLinuxのディレクトリと一時的に結びつけ、アクセス可能にする  
https://eng-entrance.com/linux-command-mount

```
mount       マウントしているデバイスを表示
mount -a    /etc/fstab に設定されているファイルシステムすべてをマウント
mount -t    ファイルシステムを全てマウント
mount -r    読み出し専用でマウント
mount -o    マウントオプションの設定

・マウントオプション
async       入出力を非同期で実行
ro          読み取り専用モードでマウント
rw          読み書き可能モードでマウント
user        一般ユーザにマウントを許可

umount      マウントを解除

df          ディスクの空き容量を表示
/media      cdやdvdをマウントするファイルシステム
```

##### 実際にコマンドを使ってパーティションの作成

```
lsblk       パーティションとファイルシステムを表示

ディスクsdaのパーティション情報が表示される。
sda1        OS起動関連のプログラム
sda2        ルートディレクトリとスワップ領域
------------------------------------------------------
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda           8:0    0   12G  0 disk
├─sda1        8:1    0    1G  0 part /boot
└─sda2        8:2    0   11G  0 part
  ├─cl-root 253:0    0  9.8G  0 lvm  /
  └─cl-swap 253:1    0  1.2G  0 lvm  [SWAP]
sr0          11:0    1 1024M  0 rom
------------------------------------------------------

パーティション追加のため、virturl boxの容量を増やす

shutdown -h now

virtual boxの画面に行き、設定 => ストレージ => コントローラーSATAを選択し、ハードディスクの追加アイコン => 作成ボタン => VDIを選択 => 可変を選択 => 容量設定 => 作成完了

centOSを起動し、rootユーザに接続
再度 lsblk コマンドを実行すると sdb が追加されている

------------------------------------------------------
sda           8:0    0   12G  0 disk 
├─sda1        8:1    0    1G  0 part /boot
└─sda2        8:2    0   11G  0 part 
  ├─cl-root 253:0    0  9.8G  0 lvm  /
  └─cl-swap 253:1    0  1.2G  0 lvm  [SWAP]
sdb           8:16   0    1G  0 disk 
sr0          11:0    1 1024M  0 rom 
------------------------------------------------------


fdisk -l /dev/sdb     sdbのパーディションを表示

------------------------------------------------------
ディスク /dev/sdb: 1 GiB, 1073741824 バイト, 2097152 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト
------------------------------------------------------

fdisk /dev/sdb       対話モードへ移行   mを押すとコマンド一覧表示

p                    パーディションを表示   fdisk -l /dev/sdb と同じ
n                    パーティションの作成。以下の流れで、各項目に回答する形でパーティション設定を行う。

------------------------------------------------------
パーティションタイプ
   p   基本パーティション (0 プライマリ, 0 拡張, 4 空き)
   e   拡張領域 (論理パーティションが入ります)
選択 (既定値 p): p
パーティション番号 (1-4, 既定値 1): 1
最初のセクタ (2048-2097151, 既定値 2048): 2048
最終セクタ, +セクタ番号 または +サイズ{K,M,G,T,P} (2048-2097151, 既定値 2097151): 500000

新しいパーティション 1 をタイプ Linux、サイズ 243.1 MiB で作成しました。
------------------------------------------------------

w                    パーティションの変更を保存し、対話モードを終了

------------------------------------------------------
コマンド (m でヘルプ): w
パーティション情報が変更されました。
ioctl() を呼び出してパーティション情報を再読み込みします。
ディスクを同期しています。
------------------------------------------------------

lsblk                sdbディスクにsdb1のパーティションが作成されたのが確認できる

------------------------------------------------------
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda           8:0    0    12G  0 disk
├─sda1        8:1    0     1G  0 part /boot
└─sda2        8:2    0    11G  0 part
  ├─cl-root 253:0    0   9.8G  0 lvm  /
  └─cl-swap 253:1    0   1.2G  0 lvm  [SWAP]
sdb           8:16   0     1G  0 disk
└─sdb1        8:17   0 243.1M  0 part
sr0          11:0    1  1024M  0 rom
------------------------------------------------------

fdisk /dev/sdb       再度対話モードへ移行し、2つ目のパーティションを作成

------------------------------------------------------
コマンド (m でヘルプ): n
パーティションタイプ
   p   基本パーティション (1 プライマリ, 0 拡張, 3 空き)
   e   拡張領域 (論理パーティションが入ります)
選択 (既定値 p): p
パーティション番号 (2-4, 既定値 2): 2
最初のセクタ (500001-2097151, 既定値 501760): 501760
最終セクタ, +セクタ番号 または +サイズ{K,M,G,T,P} (501760-2097151, 既定値 2097151): 1000000

新しいパーティション 2 をタイプ Linux、サイズ 243.3 MiB で作成しました。
------------------------------------------------------

3つ目のパーティションを作成

------------------------------------------------------
コマンド (m でヘルプ): n
パーティションタイプ
   p   基本パーティション (2 プライマリ, 0 拡張, 2 空き)
   e   拡張領域 (論理パーティションが入ります)
選択 (既定値 p): p
パーティション番号 (3,4, 既定値 3): 3
最初のセクタ (500001-2097151, 既定値 1001472): 1001472
最終セクタ, +セクタ番号 または +サイズ{K,M,G,T,P} (1001472-2097151, 既定値 2097151): 1500000

新しいパーティション 3 をタイプ Linux、サイズ 243.4 MiB で作成しました。
------------------------------------------------------

p    パーティション情報の表示

------------------------------------------------------
ディスク /dev/sdb: 1 GiB, 1073741824 バイト, 2097152 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト
ディスクラベルのタイプ: dos
ディスク識別子: 0x8335d08a

デバイス   起動 開始位置 終了位置 セクタ サイズ Id タイプ
/dev/sdb1           2048   500000 497953 243.1M 83 Linux
/dev/sdb2         501760  1000000 498241 243.3M 83 Linux
/dev/sdb3        1001472  1500000 498529 243.4M 83 Linux
------------------------------------------------------

4つ目のパーティションを作成

------------------------------------------------------
コマンド (m でヘルプ): n
パーティションタイプ
   p   基本パーティション (3 プライマリ, 0 拡張, 1 空き)
   e   拡張領域 (論理パーティションが入ります)
選択 (既定値 e): p

パーティション 4 を選択
最初のセクタ (500001-2097151, 既定値 1501184): 1501184
最終セクタ, +セクタ番号 または +サイズ{K,M,G,T,P} (1501184-2097151, 既定値 2097151): 2000000

新しいパーティション 4 をタイプ Linux、サイズ 243.6 MiB で作成しました。
------------------------------------------------------

5つ目のパーティションを作成しようとするとエラーが発生(MBRではパーティションは4つまで。1つを拡張パーティションで作成し、その中に論理パーティションを作成する必要がある)

------------------------------------------------------
コマンド (m でヘルプ): n
これ以上のパーティションを作成したい場合は、まず既存の基本パーティションを1つ、拡張パーティションに置き換えてください。
------------------------------------------------------

d 4         4つ目のパーティションを削除

------------------------------------------------------
コマンド (m でヘルプ): d
パーティション番号 (1-4, 既定値 4): 4

パーティション 4 を削除しました。
------------------------------------------------------

4つ目のパーティションを拡張パーティションで作成

------------------------------------------------------
コマンド (m でヘルプ): n
パーティションタイプ
   p   基本パーティション (3 プライマリ, 0 拡張, 1 空き)
   e   拡張領域 (論理パーティションが入ります)
選択 (既定値 e): e

パーティション 4 を選択
最初のセクタ (500001-2097151, 既定値 1501184): 1501184
最終セクタ, +セクタ番号 または +サイズ{K,M,G,T,P} (1501184-2097151, 既定値 2097151): 2097151

新しいパーティション 4 をタイプ Extended、サイズ 291 MiB で作成しました。
------------------------------------------------------

p       拡張パーティションとして作成されたのを確認

------------------------------------------------------
デバイス   起動 開始位置 終了位置 セクタ サイズ Id タイプ
/dev/sdb1           2048   500000 497953 243.1M 83 Linux
/dev/sdb2         501760  1000000 498241 243.3M 83 Linux
/dev/sdb3        1001472  1500000 498529 243.4M 83 Linux
/dev/sdb4        1501184  2097151 595968   291M  5 拡張領域
------------------------------------------------------

論理パーティションを作成(5つ目)

------------------------------------------------------
コマンド (m でヘルプ): n
全ての基本パーティションが使用済みです。
論理パーティション 5 を追加します
最初のセクタ (1503232-2097151, 既定値 1503232): 1503232
最終セクタ, +セクタ番号 または +サイズ{K,M,G,T,P} (1503232-2097151, 既定値 2097151): 1700000

新しいパーティション 5 をタイプ Linux、サイズ 96.1 MiB で作成しました。
------------------------------------------------------

論理パーティションを作成(6つ目)

------------------------------------------------------
コマンド (m でヘルプ): n
全ての基本パーティションが使用済みです。
論理パーティション 6 を追加します
最初のセクタ (1702049-2097151, 既定値 1703936): 1703936
最終セクタ, +セクタ番号 または +サイズ{K,M,G,T,P} (1703936-2097151, 既定値 2097151): 2097151

新しいパーティション 6 をタイプ Linux、サイズ 192 MiB で作成しました。
------------------------------------------------------

w       パーティションの変更を保存して終了

lsblk       sdbディスクにパーティション1-6が確認できる

------------------------------------------------------
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda           8:0    0    12G  0 disk
├─sda1        8:1    0     1G  0 part /boot
└─sda2        8:2    0    11G  0 part
  ├─cl-root 253:0    0   9.8G  0 lvm  /
  └─cl-swap 253:1    0   1.2G  0 lvm  [SWAP]
sdb           8:16   0     1G  0 disk
├─sdb1        8:17   0 243.1M  0 part
├─sdb2        8:18   0 243.3M  0 part
├─sdb3        8:19   0 243.4M  0 part
├─sdb4        8:20   0     1K  0 part
├─sdb5        8:21   0  96.1M  0 part
└─sdb6        8:22   0   192M  0 part
sr0          11:0    1  1024M  0 rom
------------------------------------------------------

mkfs -t xfs /dev/sdb1        /dev/sdb1 のパーティションをxfs形式のファイルシステムでフォーマットすることで、実際に使えるようになる。
(フォーマット形式を間違えた場合は -f オプションを付けて強制上書き可能   mkfs.xfs -f  /dev/sdb1)

------------------------------------------------------
meta-data=/dev/sdb1              isize=512    agcount=4, agsize=15561 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1
data     =                       bsize=4096   blocks=62244, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=1368, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
------------------------------------------------------

mount /dev/sdb1 /var       sdb1ディレクトリに対してvarディレクトリをマウントする(/varの内容がsdb1に出力される)

df -k                      ブロックサイズを1kとしてディスクの容量を表示
/dev/sdb1 が /var にマウントされているのを確認できる
https://atmarkit.itmedia.co.jp/ait/articles/1610/24/news017.html

------------------------------------------------------
ファイルシス        1K-ブロック    使用  使用可 使用% マウント位置
devtmpfs                 901848       0  901848    0% /dev
tmpfs                    930392       0  930392    0% /dev/shm
tmpfs                    930392    9060  921332    1% /run
tmpfs                    930392       0  930392    0% /sys/fs/cgroup
/dev/mapper/cl-root    10258432 6958036 3300396   68% /
/dev/sda1               1038336  234116  804220   23% /boot
tmpfs                    186076       4  186072    1% /run/user/1000
/dev/sdb1                243504   14412  229092    6% /var
------------------------------------------------------

umount /dev/sdb1        マウントを解除

fdisk /dev/sdb          対話モード起動
d => パーティション番号    パーティションを削除
w                       対話モード終了
```

##### パーティションをスワップ領域として利用する

```
swapon -s           スワップ領域の表示

------------------------------------------------------
ファイル名				タイプ		サイズ	使用済み	優先順位
/dev/dm-1                              	partition	1261564	0	-2
------------------------------------------------------

mkswap /dev/sdb2    スワップ領域の作成

------------------------------------------------------
スワップ空間バージョン 1 を設定します。サイズ = 243.3 MiB (255094784 バイト)
ラベルはありません, UUID=5cbaed2a-d484-4b5d-bc21-352e28e2fd2d
------------------------------------------------------

swapon /dev/sdb2    作成したスワップ領域を有効にする

再度 swapon -s       スワップ領域の認識を確認

------------------------------------------------------
/dev/dm-1                              	partition	1261564	0	-2
/dev/sdb2                              	partition	249116	0	-3
------------------------------------------------------

swapoff /dev/sdb2   スワップ領域を無効にする

```

##### partedコマンドでパーティションの作成

```
parted     対話モード起動

help       コマンド一覧表示

------------------------------------------------------
(parted) help
  align-check TYPE N           パーティション N のアライメント(TYPE: min|opt)をチェックする
  help [コマンド]               ヘルプ表示。コマンド指定でそのヘルプを表示
  mklabel,mktable ラベルの種類  新しいラベル(パーティションテーブル)を作る
  mkpart パーティションの種類 [ファイルシステムの種類] 開始 終了
         パーティションを作る
  name NUMBER 名前              パーティションに名前をつける
  print [devices|free|list,all|NUMBER]
         パーティションテーブルや、利用可能なデバイス、空き領域、
         見つかった全てのパーティション、あるいは特定のパーティションについて表示する
  quit                         プログラムを終了する
  rescue 開始 終了              開始、終了で指定した範囲付近にあるパーティションを復活させる
  resizepart NUMBER END        パーティション NUMBER を END にリサイズする
  rm NUMBER                    パーティションを削除する
  select デバイス               操作するデバイスを選択
  disk_set FLAG STATE          選択したデバイスの FLAG を変更
  disk_toggle [FLAG]           選択したデバイスの FLAG の状態をトグル
  set NUMBER フラグ 状態        ファイルシステムのフラグと状態を設定する
  toggle [NUMBER [FLAG]]       パーティションのフラグの状態を反転する
  unit UNIT                    デフォルトの単位を UNIT にする
  version                      GNU Parted のバージョンと著作権情報を表示
------------------------------------------------------

select /dev/sdb        操作デバイスを指定

------------------------------------------------------
(parted) select /dev/sdb
/dev/sdb を使用
------------------------------------------------------

print                  パーティション情報表示

------------------------------------------------------
(parted) print
モデル: ATA VBOX HARDDISK (scsi)
ディスク /dev/sdb: 1074MB
セクタサイズ (論理/物理): 512B/512B
パーティションテーブル: msdos
ディスクフラグ: 
------------------------------------------------------

mklabel => 新しいディスクラベル? gpt => /dev/sdb のディスクラベルは破壊され、このディスクの全データが失われます。続行しますか？ yes => gpt方式で再フォーマット

再度 print             パーティションテーブルがgptに変更されている

------------------------------------------------------
(parted) print
モデル: ATA VBOX HARDDISK (scsi)
ディスク /dev/sdb: 1074MB
セクタサイズ (論理/物理): 512B/512B
パーティションテーブル: gpt
ディスクフラグ:
------------------------------------------------------

mkpart                パーティション作成

------------------------------------------------------
(parted) mkpart
パーティションの名前?  []? sdb1
ファイルシステムの種類?  [ext2]? xfs
開始? 0
終了? 200
警告: The resulting partition is not properly aligned for best performance: 34s % 2048s != 0s
無視(I)/Ignore/取消(C)/Cancel? I
------------------------------------------------------

print                パーティションが追加で表示される

------------------------------------------------------
番号  開始    終了   サイズ  ファイルシステム  名前  フラグ
 1    17.4kB  200MB  200MB   xfs               sdb1
------------------------------------------------------

mkpartを連続してパーティションを5つ作成
その後、パーティションを確認

------------------------------------------------------
(parted) mkpart
パーティションの名前?  []? sdb2
ファイルシステムの種類? [ext2]? xfs
開始? 201
終了? 400
(parted) mkpart
パーティションの名前?  []? sdb3
ファイルシステムの種類?  [ext2]? xfs
開始? 401
終了? 600
(parted) mkpart
パーティションの名前?  []? sdb4
ファイルシステムの種類?  [ext2]? xfs
開始? 601
終了? 800
(parted) mkpart
パーティションの名前?  []? sdb5
ファイルシステムの種類?  [ext2]? xfs
開始? 801
終了? 1000
(parted) print
モデル: ATA VBOX HARDDISK (scsi)
ディスク /dev/sdb: 1074MB
セクタサイズ (論理/物理): 512B/512B
パーティションテーブル: gpt
ディスクフラグ:

番号  開始    終了    サイズ  ファイルシステム  名前  フラグ
 1    17.4kB  200MB   200MB   xfs               sdb1
 2    201MB   400MB   198MB   xfs               sdb2
 3    401MB   600MB   199MB   xfs               sdb3
 4    601MB   800MB   199MB   xfs               sdb4
 5    801MB   1000MB  199MB   xfs               sdb5

------------------------------------------------------

quit        対話モード終了

lsblk

------------------------------------------------------
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda           8:0    0    12G  0 disk
├─sda1        8:1    0     1G  0 part /boot
└─sda2        8:2    0    11G  0 part
  ├─cl-root 253:0    0   9.8G  0 lvm  /
  └─cl-swap 253:1    0   1.2G  0 lvm  [SWAP]
sdb           8:16   0     1G  0 disk
├─sdb1        8:17   0 190.7M  0 part
├─sdb2        8:18   0   189M  0 part
├─sdb3        8:19   0   190M  0 part
├─sdb4        8:20   0   190M  0 part
└─sdb5        8:21   0   190M  0 part
sr0          11:0    1  1024M  0 rom
------------------------------------------------------

mkfs.xfs /dev/sdb1     sdb1のパーティション内にxfsのファイルシステム作成
mount /dev/sdb1 /home  homeディレクトリをマウント
df -k                  ブロックサイズを1kとしてディスクの容量を表示
/home が /dev/sdb1 にマウントしているのがわかる

------------------------------------------------------
ファイルシス        1K-ブロック    使用  使用可 使用% マウント位置
devtmpfs                 901848       0  901848    0% /dev
tmpfs                    930392       0  930392    0% /dev/shm
tmpfs                    930392    9056  921336    1% /run
tmpfs                    930392       0  930392    0% /sys/fs/cgroup
/dev/mapper/cl-root    10258432 6957036 3301396   68% /
/dev/sda1               1038336  234116  804220   23% /boot
tmpfs                    186076       4  186072    1% /run/user/1000
/dev/sdb1                189824   11356  178468    6% /home
------------------------------------------------------

```